{{			
    config (			
        materialized="table",			
        alias='policy_fh', 			
        database='report', 			
        schema='daily_apps',
        grants = {'ownership': ['FH_READER']},
        tags=["daily_apps", "large_case"]			
    )			
}}

    SELECT
    POL.FH_POLICYCATEGORY,
    POLICYCODE,
    POL.POLICYGROUPCODE,
    FH_SERVICINGAGTCODE,
    FH_SERVICINGAGTSPLIT,
    FH_COMMISSIONINGAGTCODE,
    FH_COMMISSIONINGAGTSPLIT,
    FH_CARRIERENG,
    FH_CARRIERFR,
    POL.POLICYNUMBER,
    PLANID,
    FH_PLANTYPE,
    FH_PLANNAMEENG,
    FH_PLANNAMEFR,
    PREMIUMAMOUNT,
    CREATEDDATE,
    FH_STATUSCODE,
    FH_STATUSNAMEENG,
    FH_STATUSNAMEFR,
    FH_STATUSCATEGORY,
    APPCOUNT,
    FH_FYCSERVAMT,
    FH_FYCCOMMAMT,
    ISSUEPROVINCE,
    FH_APPSOURCE,
    FH_APPTYPE,
    POL.FH_SETTLEMENTDATE,
    POL.FH_STARTDATE,
    FH_PREMIUM,
    FH_PREM_COMMWGT,
    FH_PREM_SERVWGT,
    ISMAINCOVERAGE,
    POL.FH_PLACEDDATE,
    FH_FYCPLACED,
    --FH_SERVICINGAGT_UD2, 
    --FH_COMMISSIONINGAGT_UD2, 
    FH_COMMISSIONINGAGT_REGION, 
    FH_COMMISSIONINGAGT_MARKET, 
    FH_COMMISSIONINGAGT_LOCATION, 
    FH_COMMISSIONINGAGT_USERDEFINED2, 
    FH_SERVICINGAGT_REGION, 
    FH_SERVICINGAGT_MARKET, 
    FH_SERVICINGAGT_LOCATION, 
    FH_SERVICINGAGT_USERDEFINED2, 
    FH_COMMISSIONINGAGT_BROKERID, 
    FH_COMMISSIONINGAGT_SEGMENTTAGWS, 
    FH_COMMISSIONINGAGT_COS_SALES_BDC, 
    FH_COMMISSIONINGAGT_COS_SALES_BDD, 
    FH_COMMISSIONINGAGT_COS_SALES_RVP, 
    FH_COMMISSIONINGAGT_NAME, 
    FH_SERVICINGAGT_BROKERID, 
    FH_SERVICINGAGT_SEGMENTTAGWS, 
    FH_SERVICINGAGT_COS_SALES_BDC, 
    FH_SERVICINGAGT_COS_SALES_BDD, 
    FH_SERVICINGAGT_COS_SALES_RVP, 
    FH_SERVICINGAGT_NAME,
    CL_ADVISOR_GROUP_IDENTIFIER,
     CASE
        WHEN WRIT.POLICYGROUPCODE IS NOT NULL THEN TRUE
        ELSE FALSE
    END AS WRITTEN_LG_CASE,
    CASE
        WHEN WRIT.POLICYGROUPCODE IS NULL THEN TRUE
        ELSE FALSE
    END AS WRITTEN_NORMAL_CASE,
    CASE
        WHEN WRIT_NORM.POLICYGROUPCODE IS NOT NULL THEN WRIT_NORM.WRITTEN_COMM_PREM
    END AS WRITTEN_NORMAL_COMM_PREM,
    CASE
        WHEN WRIT.POLICYGROUPCODE IS NOT NULL THEN WRIT.WRITTEN_COMM_PREM
    END AS WRITTEN_LARGE_CASE_COMM_PREM,
    CASE
        WHEN PD.POLICYGROUPCODE IS NOT NULL THEN TRUE
        ELSE FALSE
    END AS PAID_LG_CASE,
    CASE
        WHEN PD_NORM.POLICYGROUPCODE IS NOT NULL THEN TRUE
        ELSE FALSE
    END AS PAID_NORMAL_CASE,
    CASE
        WHEN PD.POLICYGROUPCODE IS NOT NULL THEN PD.PAID_COMM_PREM
    END AS PAID_LARGE_COMM_PREM,
    CASE
        WHEN PD_NORM.POLICYGROUPCODE IS NOT NULL THEN PD_NORM.PAID_COMM_PREM
    END AS PAID_NORMAL_COMM_PREM,
    CASE
        WHEN PLACE.POLICYGROUPCODE IS NOT NULL THEN TRUE
        ELSE FALSE
    END AS PLACED_LG_CASE,
    CASE
        WHEN PLACE_NORM.POLICYGROUPCODE IS NOT NULL THEN TRUE
        ELSE FALSE
    END AS PLACED_NORMAL_CASE,
    CASE
        WHEN PLACE.POLICYGROUPCODE IS NOT NULL THEN PLACE.PLACED_COMM_PREM
    END AS PLACED_LARGE_COMM_PREM,
    CASE
        WHEN PLACE_NORM.POLICYGROUPCODE IS NOT NULL THEN PLACE_NORM.PLACED_COMM_PREM
    END AS PLACED_NORMAL_CASE_COMM_PREM
FROM
    {{ ref('policy_fh_cl_report_insurance') }} POL
    LEFT JOIN {{ ref('written_large_case_report_daily_apps') }} WRIT ON POL.POLICYGROUPCODE = WRIT.POLICYGROUPCODE
    AND POL.FH_STARTDATE = WRIT.FH_STARTDATE
    LEFT JOIN {{ ref('paid_large_case_report_daily_apps') }}  PD ON POL.POLICYGROUPCODE = PD.POLICYGROUPCODE
    AND POL.FH_POLICYCATEGORY = PD.FH_POLICYCATEGORY
    LEFT JOIN {{ ref('written_normal_case_report_daily_apps') }} WRIT_NORM ON POL.POLICYGROUPCODE = WRIT_NORM.POLICYGROUPCODE
    AND POL.FH_STARTDATE = WRIT_NORM.FH_STARTDATE
    LEFT JOIN {{ ref('paid_normal_case_report_daily_apps') }} PD_NORM ON POL.POLICYGROUPCODE = PD_NORM.POLICYGROUPCODE
    AND POL.FH_POLICYCATEGORY = PD_NORM.FH_POLICYCATEGORY 
    LEFT JOIN {{ ref('placed_large_case_report_daily_apps') }} PLACE ON  POL.POLICYGROUPCODE = PLACE.POLICYGROUPCODE 
    AND POL.FH_POLICYCATEGORY = PLACE.FH_POLICYCATEGORY
    LEFT JOIN {{ ref('placed_normal_case_report_daily_apps') }} PLACE_NORM ON POL.POLICYGROUPCODE = PLACE_NORM.POLICYGROUPCODE
    AND POL.FH_POLICYCATEGORY = PLACE_NORM.FH_POLICYCATEGORY